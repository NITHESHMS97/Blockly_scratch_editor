<!DOCTYPE html>
<html>
<head>
	<title>i4</title>
	<script >
		msg1="xx";
		msg2="";
		msg3="";
		

	</script>
	<script src="port_dict.js"></script>
	<script src="blockly/blockly_compressed.js"></script>
	<script src="blockly/blocks_compressed.js"></script>
	<script src="blockly/javascript_compressed.js"></script>
	<script src="blockly/msg/js/en.js"></script>
	<script src="custom_generator_ports.js"></script>
	<script src="custom_blocks_ports.js"></script>
	<script src="custom_blocks.js" ></script>
	<script src="custom_blocks_ports.js" ></script>
	<script src="custom_generator1.js"></script>
	<script src="serialport.js"></script>

	<xml id="toolbox"  style="display: none">

		<category name="ports" colour="100"> 
			<category name="A" colour="110">
				<block type="A1"></block>
				<block type="A2"></block>
				<block type="A3"></block>
				<block type="A4"></block>
			</category>
			<category name="B" colour="120">
				<block type="B1"></block>
				<block type="B2"></block>
				<block type="B3"></block>
				<block type="B4"></block>
			</category>
			<category name="C" colour="130">
				<block type="C1"></block>
				<block type="C2"></block>
				<block type="C3"></block>
				<block type="C4"></block>
			</category>
			<category name="F" colour="140">
				<block type="F1"></block>
				<block type="F2"></block>
			</category>
			<category name="G" colour="150">
				<block type="G1"></block>
				<block type="G2"></block>
			</category>
			<category name="M" colour="160">
				<block type="M1"></block>
				<block type="M2"></block>
				<block type="M3"></block>
				<block type="M4"></block>
			</category>
		</category>
		<category name="start/end" colour="200">
			<block type="start"></block>
			<block type="end"></block>
		</category>
		<category name="value/logic" colour="210">
			<block type="value"></block>
			<block type="logic"></block>
		</category>
		<cateory name="wait" colour="220">	
			<block type="wait"></block>
		</cateory>
		<category name="if " colour="230">
			<block type="if_do"></block>
			<block type="logic_compare"></block>
		</category>
		<category name="repeat" colour="230">
		<block type="repeat"></block>
		</category>
		</category>
	</xml>

</head>
<body>
	<div id="blocklyDiv" style="height:450px;width:1200px;"></div>
<!--	<p id="codehere"> GET CODE HERE</p>
	<p id="finalcode">FINAL CODE</p>
	<p id="startgen">startgen</p>
	<p id="ifucan"> abcuis</p>
	<p id="repeatf">repeatdebug</p>
	<p id="p6">p6</p>
	<p id="p7">p7</p>

-->
	<p id="p1"></p>
	<form action="http://127.0.0.1:3000" method="POST" style="display:inline">
		<input type="hidden" id="text" name="code"/>
		<input type="submit"  name="submit"/>
	</form>
<!--	
	<input type="button" name="save"  value="save" onclick="save()"/>
	<input type="file"  name="loadfile" id="loadfile"/>
-->
	<input type="button" name="save" value="save" onclick="savef()"/>
	<input type="button" name="load"  value="load" onclick="loadf()"/>
	<input type="file"  name="loadfile" id="loadfile" />
</body>
<script>
/*
function save()
	{
		var filename = prompt("Please enter filename", "new1");
		var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
	    var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
	 //   alert(xmlText);
		
   		localStorage.setItem("savedblockly.xml", xmlText);

	}
	document.getElementById('loadfile').onchange = function () {
	var s=this.value;
	alert(this.value);
	var x=s.substring(s.lastIndexOf("\\")+1,s.length);
	var xmlText = localStorage.getItem("savedblockly.xml");
    if (xmlText) {
        Blockly.mainWorkspace.clear();
        xmlDom = Blockly.Xml.textToDom(xmlText);
        Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xmlDom);
	}
	document.getElementById('savefile').onchange = function () {
		alert("hi")
	}
};
*/
</script>
<script>
	function loada(evt)
	{
		var f = evt.target.files[0]; 
		var contents;
		if (f) {
		var r = new FileReader();
		r.onload = function(e) { 
			contents = e.target.result;
//			alert(contents);  
			var xmlText=contents;
//			alert(xmlText)
			if (xmlText)
			{
				Blockly.mainWorkspace.clear();
				xmlDom = Blockly.Xml.textToDom(xmlText);
				Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xmlDom);
			}
		}
		r.readAsText(f);
		}
		else 
		{ 
			alert("Failed to load file");
		}	
		
	}
	document.getElementById('loadfile').addEventListener('change', loada, false);
</script>
<script>
	var filename;
	function savef() 
	{
		filename = prompt("Please enter filename", "new1");
		var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
		var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
    	blob = new Blob([xmlText], { type: 'text/plain' }),
	    anchor = document.createElement('a');

		anchor.download = filename;
		anchor.href = (window.webkitURL || window.URL).createObjectURL(blob);
		anchor.dataset.downloadurl = ['text/plain', anchor.download, anchor.href].join(':');
		anchor.click();
//		localStorage.setItem("blocklys.xml", xmlText);
	}
	
	function loadf()
	{
		var xmlText;
		if(filename)
			xmlText = localStorage.getItem("savedblockly.xml");
		if (xmlText)
		{
			Blockly.mainWorkspace.clear();
			xmlDom = Blockly.Xml.textToDom(xmlText);
			Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xmlDom);
		}
		for (var i = 0; i < localStorage.length; i++) 
		{
  			console.log(localStorage.key(i))
		};
	}

</script>
<script>

	  var workspace = Blockly.inject('blocklyDiv',
      {toolbox: document.getElementById('toolbox')});

		function printIt()
		{
			finalcode.innerHTML="o{"+msg1+" "+msg2+msg3;

		}
</script>
	<script>

		function myUpdateFunction(event)
		{
			var code=Blockly.JavaScript.workspaceToCode(workspace);
//			codehere.innerHTML=code;


		}
		workspace.addChangeListener(myUpdateFunction);
	</script>

</html>
